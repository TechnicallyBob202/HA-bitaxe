blueprint:
  name: Bitaxe Block Found Notification
  description: Send notification when a Bitaxe miner finds a block
  domain: automation
  input:
    notification_service:
      name: Notification Service
      description: Select where to send notifications (e.g., notify.mobile_app_phone)
      selector:
        service:
          domain: notify
    include_details:
      name: Include Mining Details
      description: Show mining stats and hardware info
      default: true
      selector:
        boolean:
    include_pool_info:
      name: Include Pool Information
      description: Show pool URL, port, and WiFi SSID
      default: true
      selector:
        boolean:

trigger:
  - platform: event
    event_type: bitaxe_block_found

condition: []

action:
  - choose:
      - conditions: "{{ include_details and include_pool_info }}"
        sequence:
          - service: "{{ notification_service }}"
            data:
              title: "ğŸ‰ Bitcoin Block Found!"
              message: |
                Miner {{ trigger.event.data.miner_ip }} found a block!
                
                ğŸ“Š **Mining Stats:**
                â€¢ Total Blocks: {{ trigger.event.data.total_blocks }}
                â€¢ Session Blocks: {{ trigger.event.data.blocks_this_session }}
                â€¢ Hashrate: {{ (trigger.event.data.hashrate / 1000000) | round(2) }} MH/s
                â€¢ Best Diff: {{ trigger.event.data.total_best_diff }}
                
                ğŸŒ¡ï¸ **Hardware:**
                â€¢ Temperature: {{ trigger.event.data.temperature }}Â°C
                â€¢ Device: {{ trigger.event.data.device_model }}
                
                ğŸŒ **Network:**
                â€¢ WiFi: {{ trigger.event.data.ssid }}
                â€¢ Pool: {{ trigger.event.data.stratum_url }}:{{ trigger.event.data.stratum_port }}
                â€¢ Connected: {{ "Yes" if trigger.event.data.pool_connected else "No" }}
      - conditions: "{{ include_details and not include_pool_info }}"
        sequence:
          - service: "{{ notification_service }}"
            data:
              title: "ğŸ‰ Bitcoin Block Found!"
              message: |
                Miner {{ trigger.event.data.miner_ip }} found a block!
                
                ğŸ“Š **Mining Stats:**
                â€¢ Total Blocks: {{ trigger.event.data.total_blocks }}
                â€¢ Session Blocks: {{ trigger.event.data.blocks_this_session }}
                â€¢ Hashrate: {{ (trigger.event.data.hashrate / 1000000) | round(2) }} MH/s
                â€¢ Best Diff: {{ trigger.event.data.total_best_diff }}
                
                ğŸŒ¡ï¸ **Hardware:**
                â€¢ Temperature: {{ trigger.event.data.temperature }}Â°C
                â€¢ Device: {{ trigger.event.data.device_model }}
      - conditions: "{{ not include_details and include_pool_info }}"
        sequence:
          - service: "{{ notification_service }}"
            data:
              title: "ğŸ‰ Bitcoin Block Found!"
              message: |
                Miner {{ trigger.event.data.miner_ip }} found a block #{{ trigger.event.data.total_blocks }}
                
                Pool: {{ trigger.event.data.stratum_url }}:{{ trigger.event.data.stratum_port }}
                WiFi: {{ trigger.event.data.ssid }}
    default:
      - service: "{{ notification_service }}"
        data:
          title: "ğŸ‰ Bitcoin Block Found!"
          message: "Miner {{ trigger.event.data.miner_ip }} found block #{{ trigger.event.data.total_blocks }}"